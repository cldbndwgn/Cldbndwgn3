<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Cldcipher â€” Single File App</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* ========= GLOBAL STYLES ========= */
    :root{
      --bg:#f6fbfc; --card:#fff; --muted:#52656b;
      --primary:#2563eb; --accent:#0ea37a;
      --mono: 'Courier New', monospace;
      --ui: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:var(--ui);background:linear-gradient(180deg,var(--bg),#eef7f8);color:#0a1b20;-webkit-font-smoothing:antialiased}
    a{color:var(--primary)}
    header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:linear-gradient(90deg,#f7fbfd,#ffffff);border-bottom:1px solid rgba(2,6,23,0.04)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;color:#002;font-weight:800;font-family:var(--mono)}
    .title{font-family:var(--mono);font-weight:700}
    .subtitle{font-size:12px;color:var(--muted)}
    .top-actions{display:flex;gap:8px;align-items:center}
    .btn{padding:8px 12px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);background:transparent;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff;border:none}
    .container{max-width:1100px;margin:18px auto;padding:0 16px 80px}
    .grid{display:grid;grid-template-columns:300px 1fr;gap:18px}
    @media(max-width:920px){ .grid{grid-template-columns:1fr} header{flex-direction:column;align-items:flex-start} .top-actions{margin-top:8px} }
    .panel{background:var(--card);border-radius:12px;padding:12px;border:1px solid rgba(2,6,23,0.04);box-shadow:0 8px 24px rgba(6,50,56,0.04)}
    .small{font-size:13px;color:var(--muted)}
    .muted{color:var(--muted)}
    .fun-carousel{height:260px;overflow:auto;padding:8px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfffe)}
    .fun-item{padding:10px;border-radius:8px;background:#fff;margin-bottom:8px;border:1px solid rgba(2,6,23,0.03)}
    .hero{display:flex;justify-content:space-between;align-items:center;padding:18px;border-radius:14px;background:linear-gradient(180deg,#ffffff,#f7fffb)}
    .avatar{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;color:#001;font-weight:800;font-family:var(--mono)}
    .accordion{border-radius:10px;border:1px solid rgba(2,6,23,0.04);overflow:hidden}
    .acc-item + .acc-item{margin-top:8px}
    .acc-head{background:#fbfffb;padding:12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
    .acc-body{padding:12px;display:none;background:#fff}
    pre{background:#0b1220;color:#dff9ee;padding:12px;border-radius:8px;overflow:auto;font-family:var(--mono);font-size:13px}
    .option-btn{display:block;width:100%;text-align:left;padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.04);background:transparent;margin-top:8px;cursor:pointer}
    .option-btn.correct{outline:3px solid rgba(46,204,113,0.12)}
    .option-btn.wrong{outline:3px solid rgba(231,76,60,0.12)}
    .game-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(max-width:720px){ .game-grid{grid-template-columns:1fr} }
    .meter{height:12px;background:#f1fbf9;border-radius:8px;overflow:hidden;border:1px solid rgba(2,6,23,0.04)}
    .meter > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--primary),var(--accent));transition:width 400ms ease}
    .center{display:flex;align-items:center;justify-content:center}
    footer{padding:16px;text-align:center;color:var(--muted);margin-top:18px}
    input[type="text"], input[type="password"], input[type="email"], textarea { width:100%; padding:8px 10px; border-radius:8px; border:1px solid rgba(2,6,23,0.06); margin-top:8px; }
    .small-ghost{font-size:12px;color:#7a8b90}
    .badge{padding:6px 10px;border-radius:999px;background:#eefaf4;color:#013;display:inline-block;font-weight:700}
  </style>
</head>
<body>

  <header>
    <div class="brand">
      <div class="logo">CB</div>
      <div>
        <div class="title">Cldcipher</div>
        <div class="subtitle">Learn Ethical Hacking â€” Friendly & Private</div>
      </div>
    </div>

    <div class="top-actions">
      <div style="text-align:right">
        <div id="welcomeLabel" class="small">Guest</div>
        <div id="profileName" class="small muted">Not signed in</div>
      </div>
      <div id="avatarDisplay" class="avatar">ðŸ™‚</div>
      <button class="btn" id="openAuthBtn">Sign In / Sign Up</button>
      <button class="btn" id="profileBtn">Profile</button>
      <button class="btn-primary" id="dashboardBtn">Dashboard</button>
    </div>
  </header>

  <div class="container">
    <section class="hero panel" id="dashboard">
      <div style="max-width:65%">
        <h1 style="margin:0;font-family:var(--mono)">Cldcipher</h1>
        <div class="small muted" style="margin-top:8px">A modern, local-first learning playground for ethical cybersecurity. Practice safely.</div>
        <div style="height:12px"></div>
        <div class="meter" title="Overall progress"><i id="overallProgress" style="width:0%"></i></div>
        <div style="margin-top:8px" class="small">Progress: <strong id="progressText">0%</strong></div>
        <div style="margin-top:12px">
          <button class="btn-primary" id="ctaLessons">Open Lessons</button>
          <button class="btn" id="ctaQuizzes">Take Quiz</button>
          <button class="btn" id="ctaGames">Play Games</button>
        </div>
      </div>

      <div style="text-align:right">
        <div id="heroProfile" style="margin-bottom:8px">
          <div class="avatar" id="heroAvatar">ðŸ™‚</div>
          <div class="small" id="heroName">Guest</div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn" id="openTools">Tools</button>
          <button class="btn" id="openFun">Fun Facts</button>
        </div>
      </div>
    </section>

    <div class="grid" style="margin-top:16px">

      <!-- LEFT COLUMN -->
      <aside>
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Quick Links</div>
            <div class="small muted">Jump</div>
          </div>
          <div style="height:8px"></div>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button class="btn" id="navLessons">Lessons</button>
            <button class="btn" id="navQuizzes">Quizzes</button>
            <button class="btn" id="navGames">Games</button>
            <button class="btn" id="navTools">Tools</button>
            <button class="btn" id="navAbout">About</button>
          </div>

          <div style="height:12px"></div>

          <div style="font-weight:700">Fun Facts</div>
          <div class="fun-carousel" id="funFacts" tabindex="0" aria-label="Fun facts">
            <!-- Fun facts rendered via JS -->
          </div>
        </div>
      </aside>

      <!-- RIGHT COLUMN -->
      <main>

        <!-- LESSONS -->
        <section id="lessons" class="panel" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2 style="margin:0">Lessons â€” Collapsible Tutorials</h2>
            <div class="small">Completed: <strong id="doneCount">0</strong> / <span id="totalLessons">0</span></div>
          </div>
          <div style="height:12px"></div>
          <div class="accordion" id="lessonsAccordion">
            <!-- lessons filled by JS -->
          </div>
        </section>

        <!-- QUIZZES -->
        <section id="quizzes" class="panel" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h2 style="margin:0">Quizzes</h2>
              <div class="small muted">Immediate feedback. Correct answers shown when missed.</div>
            </div>
            <div><button class="btn-primary" id="startQuizBtn">Start Quiz</button></div>
          </div>
          <div style="height:12px"></div>
          <div id="quizArea"></div>
        </section>

        <!-- GAMES -->
        <section id="games" class="panel" style="display:none">
          <h2 style="margin:0">Mini Games</h2>
          <div style="height:12px"></div>
          <div class="game-grid">

            <!-- Guess Number -->
            <div class="panel">
              <h4 style="margin:0">Guess the Number</h4>
              <div class="small muted">Guess a number between 1 and 100</div>
              <input id="guessInput" placeholder="Enter your guess" type="number" min="1" max="100">
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn" id="guessBtn">Guess</button>
                <button class="btn" id="guessNew">New</button>
              </div>
              <div class="small" id="guessMsg" style="margin-top:8px">Ready</div>
            </div>

            <!-- Typing Test -->
            <div class="panel">
              <h4 style="margin:0">Typing Test (15s)</h4>
              <div id="typePhrase" class="small muted">Press start</div>
              <input id="typeInput" placeholder="Type here..." disabled>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn" id="startTypingBtn">Start</button>
                <div class="small">Result: <span id="typingResult">â€”</span></div>
              </div>
            </div>

            <!-- Memory Match -->
            <div class="panel">
              <h4 style="margin:0">Memory Match</h4>
              <div id="memGrid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px"></div>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn" id="memReset">Reset</button>
                <div class="small">Matches: <span id="memMatches">0</span></div>
              </div>
            </div>

            <!-- Rock Paper Scissors -->
            <div class="panel">
              <h4 style="margin:0">Rock Paper Scissors</h4>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn rps" data-move="rock">Rock</button>
                <button class="btn rps" data-move="paper">Paper</button>
                <button class="btn rps" data-move="scissors">Scissors</button>
              </div>
              <div class="small" style="margin-top:8px">Result: <span id="rpsRes">â€”</span></div>
            </div>

            <!-- Code Breaker -->
            <div class="panel">
              <h4 style="margin:0">Code Breaker</h4>
              <div class="small muted">Guess a 3-digit code; hints show per-digit higher/lower/ok</div>
              <input id="cbInput" placeholder="e.g. 123">
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn" id="cbGuess">Guess</button>
                <button class="btn" id="cbNew">New Code</button>
              </div>
              <div class="small" id="cbMsg" style="margin-top:8px">Ready</div>
            </div>

          </div>
        </section>

        <!-- TOOLS -->
        <section id="toolsPanel" class="panel" style="display:none">
          <h2 style="margin:0">Tools</h2>
          <div style="height:12px"></div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div class="panel">
              <h4 style="margin:0">Password Tester</h4>
              <input id="pwTest" placeholder="Type a password to test">
              <div style="height:8px" class="meter"><i id="pwTestBar"></i></div>
              <div style="display:flex;justify-content:space-between;margin-top:8px">
                <div id="pwAdvice" class="small muted">Advice appears here</div>
                <div id="pwLabel" class="badge">â€”</div>
              </div>
            </div>

            <div class="panel">
              <h4 style="margin:0">Random Hacker Alias</h4>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn" id="genName">Generate</button>
                <button class="btn" id="copyName">Copy</button>
              </div>
              <input id="nameOut" placeholder="Alias appears here" readonly style="margin-top:8px">
              <div style="height:12px"></div>
              <h4 style="margin:0">Daily Tip</h4>
              <div id="tipOut" class="small muted" style="margin-top:8px"></div>
              <div style="height:8px"></div>
              <button class="btn" id="newTip">New Tip</button>
            </div>
          </div>
        </section>

        <!-- PROFILE -->
        <section id="profilePanel" class="panel" style="display:none">
          <h2 style="margin:0">Profile</h2>
          <div style="height:12px"></div>
          <div style="display:flex;gap:12px;align-items:center">
            <div class="avatar" id="profileAvatar">ðŸ™‚</div>
            <div style="flex:1">
              <div class="small">Display name</div>
              <input id="profileDisplay" placeholder="Display name">
              <div style="height:8px"></div>
              <div class="small">Change password</div>
              <input id="profilePass" type="password" placeholder="New password">
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn" id="saveProfile">Save</button>
                <button class="btn" id="signOut">Sign Out</button>
              </div>
            </div>
          </div>
        </section>

        <!-- ABOUT -->
        <section id="about" class="panel" style="display:none">
          <h2 style="margin:0">About Cldcipher</h2>
          <div style="height:12px"></div>
          <div class="panel" style="padding:12px">
            <h3>Mission</h3>
            <p class="muted">Cldcipher helps learners study defensive cybersecurity safely with local-only storage and practical exercises.</p>
            <h3>History & Timeline</h3>
            <ol class="muted">
              <li>2023 â€” Prototype lessons & tools</li>
              <li>2024 â€” Expanded quizzes & games</li>
              <li>2025 â€” Current dashboard & local learning platform</li>
            </ol>
          </div>
        </section>

      </main>

    </div>
  </div>

  <footer>
    <div class="small muted">&copy; 2025 Cldcipher â€” Local & Private Learning</div>
  </footer>

  <!-- AUTH MODAL (fixed flow) -->
  <div id="authModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.5);z-index:99">
    <div class="panel" style="width:94%;max-width:880px;padding:16px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><h3 style="margin:0">Sign In / Sign Up</h3><div class="small muted">Your account is stored locally on this device.</div></div>
        <div><button class="btn" id="authClose">Close</button></div>
      </div>

      <div style="height:12px"></div>

      <div style="display:grid;grid-template-columns:1fr 320px;gap:12px">
        <div>
          <!-- Sign In -->
          <div id="signInPanel">
            <div class="small muted">Sign In</div>
            <input id="siUser" placeholder="Username or email">
            <input id="siPass" type="password" placeholder="Password">
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn-primary" id="btnSignIn">Sign In</button>
              <button class="btn" id="btnGotoSignUp">Create Account</button>
            </div>
            <div style="height:8px"></div>
            <div style="display:flex;gap:8px">
              <button class="btn" id="btnForgot">Forgot</button>
              <button class="btn" id="btnSkip">Skip</button>
            </div>
            <div style="height:8px"></div>
            <div id="authMsg" class="small muted"></div>
          </div>

          <!-- Sign Up -->
          <div id="signUpPanel" style="display:none">
            <div class="small muted">Sign Up</div>
            <input id="suUser" placeholder="Username or email">
            <input id="suDisplay" placeholder="Display name (optional)">
            <input id="suPass" type="password" placeholder="Password" oninput="updateSuStrength(this.value)">
            <div style="height:8px" class="meter"><i id="suBar"></i></div>
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div id="suAdvice" class="small muted">Use 10+ chars, mix letters, numbers & symbols</div>
              <div id="suLabel" class="small-ghost">â€”</div>
            </div>
            <div style="height:8px"></div>
            <div style="display:flex;gap:8px">
              <button class="btn-primary" id="btnSignUp">Sign Up</button>
              <button class="btn" id="btnGotoSignIn">Back to Sign In</button>
            </div>
          </div>

        </div>

        <div>
          <div class="panel" style="padding:12px">
            <div style="font-weight:700">Why create an account?</div>
            <ul class="muted">
              <li>Save progress & achievements locally</li>
              <li>Personalize your display name and avatar</li>
              <li>Local-only storage â€” nothing is uploaded</li>
            </ul>
            <div style="height:12px"></div>
            <div style="font-weight:700">Privacy</div>
            <div class="muted">Data stays in your browser. Clearing site data will remove accounts & progress.</div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
/* ========== CORE STORAGE & STATE ========== */
const STORAGE_USERS = 'cldc_users_v1';
const STORAGE_PROFILE = 'cldc_profile_v1';
const STORAGE_LESS = 'cldc_less_v1';
const STORAGE_QUIZ_LEAD = 'cldc_quizlead_v1';
const STORAGE_GAMES_LEAD = 'cldc_gameslead_v1';

let users = JSON.parse(localStorage.getItem(STORAGE_USERS) || '{}'); // users[username] = {password, display, avatar}
let profile = JSON.parse(localStorage.getItem(STORAGE_PROFILE) || JSON.stringify({cur:null}));
let lessonsState = JSON.parse(localStorage.getItem(STORAGE_LESS) || JSON.stringify({completed:[]}));
let quizLeaderboard = JSON.parse(localStorage.getItem(STORAGE_QUIZ_LEAD) || '[]');
let gamesLeaderboard = JSON.parse(localStorage.getItem(STORAGE_GAMES_LEAD) || '[]');

function saveAll(){
  localStorage.setItem(STORAGE_USERS, JSON.stringify(users));
  localStorage.setItem(STORAGE_PROFILE, JSON.stringify(profile));
  localStorage.setItem(STORAGE_LESS, JSON.stringify(lessonsState));
  localStorage.setItem(STORAGE_QUIZ_LEAD, JSON.stringify(quizLeaderboard));
  localStorage.setItem(STORAGE_GAMES_LEAD, JSON.stringify(gamesLeaderboard));
}

/* ========== HELPERS ========== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const rand = n => Math.floor(Math.random()*n);

/* ========== AUTH FLOW (fixed) ========== */
function openAuth(){ $('#authModal').style.display = 'flex'; showSignIn(); $('#authMsg').textContent=''; }
function closeAuth(){ $('#authModal').style.display = 'none'; }
$('#openAuthBtn').addEventListener('click', openAuth);
$('#authClose').addEventListener('click', closeAuth);

// Switch panels inside modal
function showSignIn(){ $('#signInPanel').style.display='block'; $('#signUpPanel').style.display='none'; $('#authTitle') && ($('#authTitle').innerText='Sign In'); }
function showSignUp(){ $('#signInPanel').style.display='none'; $('#signUpPanel').style.display='block'; $('#authTitle') && ($('#authTitle').innerText='Sign Up'); }
$('#btnGotoSignUp').addEventListener('click', showSignUp);
$('#btnGotoSignIn').addEventListener('click', showSignIn);

// Sign Up
function updateSuStrength(val){
  const score = passwordScore(val);
  $('#suBar').style.width = (Math.max(5, score)) + '%';
  $('#suBar').style.background = score < 35 ? 'tomato' : score < 65 ? 'orange' : '#2ecc71';
  $('#suLabel').textContent = score < 35 ? 'Weak' : score < 65 ? 'Medium' : 'Strong';
}
$('#btnSignUp').addEventListener('click', ()=>{
  const user = ($('#suUser').value||'').trim().toLowerCase();
  const display = ($('#suDisplay').value||'').trim() || user.split('@')[0] || 'User'+Math.floor(Math.random()*999);
  const pass = ($('#suPass').value||'').trim();
  if(!user || !pass){ $('#authMsg').textContent = 'Complete username and password'; return; }
  if(users[user]){ $('#authMsg').textContent = 'Account exists â€” sign in'; return; }
  const score = passwordScore(pass);
  if(score < 20){ $('#authMsg').textContent = 'Password too weak (improve length & characters)'; return; }
  users[user] = {password:pass, display, avatar:'ðŸ™‚'};
  profile.cur = user;
  saveAll();
  updateProfileUI();
  $('#authMsg').textContent = 'Account created & signed in';
  setTimeout(()=> closeAuth(), 600);
});

// Sign In
$('#btnSignIn').addEventListener('click', ()=>{
  const user = ($('#siUser').value||'').trim().toLowerCase();
  const pass = ($('#siPass').value||'').trim();
  if(!user || !pass){ $('#authMsg').textContent = 'Enter username & password'; return; }
  if(!users[user] || users[user].password !== pass){ $('#authMsg').textContent = 'Invalid credentials'; return; }
  profile.cur = user;
  saveAll();
  updateProfileUI();
  $('#authMsg').textContent = 'Signed in';
  setTimeout(()=> closeAuth(), 500);
});

// Forgot (simulated)
$('#btnForgot').addEventListener('click', ()=>{
  const email = prompt('Enter username/email for reset (local demo):');
  if(!email) return;
  const u = (email||'').trim().toLowerCase();
  if(!users[u]) return alert('No local account found for that username');
  const code = String(100000 + Math.floor(Math.random()*899999));
  alert(`Reset code (demo): ${code}\nEnter code to set new password.`);
  const entered = prompt('Enter the reset code:');
  if(entered !== code) return alert('Invalid code');
  const np = prompt('Enter new password:');
  if(!np) return alert('Cancelled');
  users[u].password = np; saveAll();
  alert('Password updated locally.');
});

// Skip button
$('#btnSkip').addEventListener('click', ()=> { closeAuth(); $('#authMsg').textContent = ''; });

// Logout & profile UI
function updateProfileUI(){
  if(profile.cur && users[profile.cur]){
    $('#welcomeLabel').textContent = 'Signed in: ' + users[profile.cur].display;
    $('#profileName').textContent = users[profile.cur].display;
    $('#avatarDisplay').textContent = users[profile.cur].avatar || 'ðŸ™‚';
    $('#heroAvatar').textContent = users[profile.cur].avatar || 'ðŸ™‚';
    $('#heroName').textContent = users[profile.cur].display || 'User';
  } else {
    profile.cur = null;
    $('#welcomeLabel').textContent = 'Guest';
    $('#profileName').textContent = 'Not signed in';
    $('#avatarDisplay').textContent = 'ðŸ™‚';
    $('#heroAvatar').textContent = 'ðŸ™‚';
    $('#heroName').textContent = 'Guest';
  }
  saveAll();
}
updateProfileUI();

function logout(){ profile.cur = null; saveAll(); updateProfileUI(); alert('Signed out'); }

/* ========== UTILS ========== */
function passwordScore(s){
  if(!s) return 0;
  let score = 0;
  if(s.length >= 8) score += 20;
  if(s.length >= 12) score += 15;
  if(/[a-z]/.test(s)) score += 10;
  if(/[A-Z]/.test(s)) score += 15;
  if(/\d/.test(s)) score += 15;
  if(/[\W_]/.test(s)) score += 25;
  return Math.min(100, score);
}

/* ========== NAVIGATION ========== */
function hideAllMain(){
  ['lessons','quizzes','games','toolsPanel','profilePanel','about','dashboard'].forEach(id => {
    const el = document.getElementById(id);
    if(el) el.style.display = 'none';
  });
}
function showSection(id){
  hideAllMain();
  if(id === 'dashboard'){ document.getElementById('dashboard').style.display='block'; window.scrollTo({top:0,behavior:'smooth'}); return; }
  const el = document.getElementById(id);
  if(el) { el.style.display = 'block'; el.scrollIntoView({behavior:'smooth'}); }
}
$('#navLessons').addEventListener('click', ()=> showSection('lessons'));
$('#navQuizzes').addEventListener('click', ()=> showSection('quizzes'));
$('#navGames').addEventListener('click', ()=> showSection('games'));
$('#navTools').addEventListener('click', ()=> showSection('toolsPanel'));
$('#navAbout').addEventListener('click', ()=> showSection('about'));
$('#profileBtn').addEventListener('click', ()=> {
  if(!profile.cur){ openAuth(); return; }
  showSection('profilePanel'); $('#profileDisplay').value = users[profile.cur].display;
});
$('#dashboardBtn').addEventListener('click', ()=> showSection('dashboard'));
$('#ctaLessons').addEventListener('click', ()=> showSection('lessons'));
$('#ctaQuizzes').addEventListener('click', ()=> showSection('quizzes'));
$('#ctaGames').addEventListener('click', ()=> showSection('games'));
$('#openTools').addEventListener('click', ()=> showSection('toolsPanel'));
$('#openFun').addEventListener('click', ()=> { document.getElementById('funFacts').scrollIntoView({behavior:'smooth'}); });

/* ========== LESSONS DATA (static, collapsible) ========== */
const LESSONS = [
  {title:"Intro â€” What is Ethical Hacking?", content:`<p>Ethical hacking is using security skills to help organizations find and fix vulnerabilities. Always have permission.</p><pre><code># setup safe folder in Linux\nmkdir ~/ctf-lab\ncd ~/ctf-lab\n</code></pre>`},
  {title:"Linux Basics", content:`<p>Learn common commands used in security research.</p><pre><code>ls -la\nip a\nss -tuln\n</code></pre>`},
  {title:"Networking Basics", content:`<p>Understand IPs, ports, TCP/UDP, and how clients & servers communicate.</p><pre><code># basic nmap scan in safe lab\nnmap -sS -p 1-1000 192.168.56.101\n</code></pre>`},
  {title:"Authentication & Passwords", content:`<p>Strong passwords, MFA, and recovery processes.</p><pre><code># generate a random passphrase (example)\nhead /dev/urandom | tr -dc 'A-Za-z0-9' | head -c 24 ; echo\n</code></pre>`},
  {title:"Web Security Concepts", content:`<p>Input validation, authentication, session management â€” conceptual overview.</p>`},
  {title:"System Hardening", content:`<p>Patch systems, disable unnecessary services, use least privilege.</p>`},
  {title:"Monitoring & Incident Response", content:`<p>Logging, alerts, and practicing incident response.</p>`},
  {title:"Safe Practice Environments", content:`<p>Use CTFs, vulnerable VMs, and isolated labs.</p>`},
  {title:"Secure Development Basics", content:`<p>Code reviews, linters, dependency checks.</p>`},
  {title:"Penetration Testing Workflow", content:`<p>Plan â†’ Discover â†’ Exploit (in lab) â†’ Report. Respect rules of engagement.</p>`}
];

function renderLessons(){
  const container = $('#lessonsAccordion');
  container.innerHTML = '';
  LESSONS.forEach((L, i) => {
    const item = document.createElement('div');
    item.className = 'acc-item';
    item.innerHTML = `
      <div class="acc-head" data-idx="${i}">
        <div style="font-weight:700">${i+1}. ${L.title}</div>
        <div class="small" id="lessonStatus${i}">${lessonsState.completed.includes(i)?'Completed':'Not done'}</div>
      </div>
      <div class="acc-body" id="lessonBody${i}">
        ${L.content}
        <div style="display:flex;justify-content:flex-end;margin-top:8px">
          <button class="btn completeLesson" data-idx="${i}">${lessonsState.completed.includes(i)?'Completed':'Mark Complete'}</button>
        </div>
      </div>
    `;
    container.appendChild(item);
  });

  // wire accordion heads
  $$('.acc-head').forEach(h => h.addEventListener('click', ()=>{
    const body = h.nextElementSibling;
    const open = body.style.display === 'block';
    $$('.acc-body').forEach(b => b.style.display = 'none');
    if(!open) body.style.display = 'block';
  }));

  // wire complete buttons
  $$('.completeLesson').forEach(btn => btn.addEventListener('click', (e)=>{
    const idx = Number(e.target.dataset.idx);
    // optional: require previous completion
    if(idx>0 && !lessonsState.completed.includes(idx-1) && !lessonsState.completed.includes(idx)){
      alert('Finish previous lessons first.');
      return;
    }
    if(!lessonsState.completed.includes(idx)) lessonsState.completed.push(idx);
    saveAll();
    document.getElementById(`lessonStatus${idx}`).textContent = 'Completed';
    e.target.textContent = 'Completed';
    updateProgress();
  }));
  document.getElementById('totalLessons').textContent = LESSONS.length;
}
renderLessons();

/* ========== PROGRESS ======== */
function updateProgress(){
  const total = LESSONS.length;
  const done = lessonsState.completed.length;
  const pct = Math.round((done/total)*100);
  $('#overallProgress').style.width = pct + '%';
  $('#progressText').textContent = pct + '%';
  $('#doneCount').textContent = done;
  saveAll();
}
updateProgress();

/* ========== FUN FACTS (10 shown, template to add to 50) ========== */
const FUNFACTS = [
  "1972: Pong popularized arcade gaming.",
  "1978: Space Invaders helped create arcade culture.",
  "1983: The video game crash reshaped the industry.",
  "1985: The NES revived console gaming.",
  "1991: Sonic introduced high-speed platforming.",
  "1993: Doom popularized the first-person shooter.",
  "1994: PlayStation opened the CD-era of games.",
  "1996: Pokemon began its global journey.",
  "2001: Halo influenced modern console shooters.",
  "2004: World of Warcraft popularized subscription MMOs."
];
// render fun facts
$('#funFacts').innerHTML = FUNFACTS.map((t,i)=>`<div class="fun-item"><strong>${i+1}.</strong> ${t}</div>`).join('');
$('#tipOut').textContent = FUNFACTS[new Date().getDate() % FUNFACTS.length];

/* ========== QUIZ (5 sample Qs; extend by adding more objects) ========== */
const QUIZ = [
  {q:"What is ethical hacking?", opts:["Illegal break-in","Permission-based testing","Scamming"], a:1},
  {q:"MFA stands for:", opts:["Multi-Factor Access","Multi-Factor Authentication","Multiple File Access"], a:1},
  {q:"Best password practice:", opts:["Short easy pass","Use long unique passphrases","Write it on paper"], a:1},
  {q:"Phishing is:", opts:["A network scan","A social engineering attack","A router issue"], a:1},
  {q:"A safe place to practice offensive skills:", opts:["Live bank servers","Authorized labs only","Random public servers"], a:1}
];
let qState = {idx:0,score:0,shuffled:[]};
$('#startQuizBtn').addEventListener('click', () => startQuiz());
function startQuiz(){
  qState.idx = 0; qState.score = 0; qState.shuffled = shuffleArray(QUIZ.slice());
  renderQuiz();
}
function renderQuiz(){
  const area = $('#quizArea'); area.innerHTML = '';
  if(qState.idx >= qState.shuffled.length){
    area.innerHTML = `<div class="panel"><h3>Quiz complete</h3><p class="muted">Score: ${qState.score} / ${qState.shuffled.length}</p><div style="display:flex;gap:8px"><button class="btn" id="closeQuiz">Close</button><button class="btn-primary" id="saveQuiz">Save Score</button></div></div>`;
    $('#closeQuiz').onclick = ()=> area.innerHTML = '';
    $('#saveQuiz').onclick = ()=> { const name = profile.cur && users[profile.cur] ? users[profile.cur].display : 'Guest-'+Math.floor(Math.random()*999); quizLeaderboard.push({name,score:qState.score,date:new Date().toISOString()}); saveAll(); alert('Score saved locally'); };
    return;
  }
  const item = qState.shuffled[qState.idx];
  let html = `<div class="panel"><strong>Q${qState.idx+1}.</strong> ${item.q}<div style="height:8px"></div>`;
  item.opts.forEach((o,i)=> html += `<button class="option-btn" data-i="${i}">${String.fromCharCode(65+i)}. ${o}</button>`);
  html += `</div>`; area.innerHTML = html;
  $$('.option-btn').forEach(b => b.addEventListener('click', (e)=>{
    const ans = Number(e.target.dataset.i);
    $$('.option-btn').forEach(x=>x.disabled = true);
    if(ans === item.a){ e.target.classList.add('correct'); qState.score++; }
    else { e.target.classList.add('wrong'); const corr = $$('.option-btn').find(x=>Number(x.dataset.i)===item.a); if(corr) corr.classList.add('correct'); }
    const ex = document.createElement('div'); ex.className='small muted'; ex.style.marginTop='8px'; ex.textContent = `Correct answer: ${String.fromCharCode(65+item.a)}.`; area.appendChild(ex);
    setTimeout(()=>{ qState.idx++; renderQuiz(); }, 900);
  }));
}
function shuffleArray(a){ const b = a.slice(); for(let i=b.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [b[i],b[j]]=[b[j],b[i]] } return b; }

/* ========== GAMES ========= */
// Guess number
let secret = rand(100) + 1;
$('#guessNew').addEventListener('click', ()=> { secret = rand(100) + 1; $('#guessMsg').textContent = 'New number set'; });
$('#guessBtn').addEventListener('click', ()=> {
  const v = Number($('#guessInput').value);
  if(!v){ $('#guessMsg').textContent = 'Enter a number'; return; }
  if(v === secret){ $('#guessMsg').textContent = 'Correct!'; addGameScore('Guess',1); } else if(v < secret) $('#guessMsg').textContent = 'Too low'; else $('#guessMsg').textContent = 'Too high';
});

// Typing test
const phrases = ["Secure your secrets with strong passphrases.","Practice safely in authorized labs only.","Backups save time and headaches.","Update software regularly for security."];
let typingTimer = null, typingTime = 15;
$('#startTypingBtn').addEventListener('click', ()=>{
  typingTime = 15;
  $('#typePhrase').textContent = phrases[rand(phrases.length)];
  $('#typeInput').disabled = false; $('#typeInput').value=''; $('#typeInput').focus();
  $('#typingResult').textContent = typingTime + 's';
  clearInterval(typingTimer);
  typingTimer = setInterval(()=>{ typingTime--; $('#typingResult').textContent = typingTime + 's'; if(typingTime<=0){ clearInterval(typingTimer); $('#typeInput').disabled=true; const words = ($('#typeInput').value||'').trim().split(/\s+/).filter(Boolean).length; $('#typingResult').textContent = words + ' w'; addGameScore('Typing', words); } },1000);
});

// Memory match
let memValues = [], memOpen = [], memMatched = [];
function setupMemory(){
  const icons = ['â™ ','â™¥','â™¦','â™£','â˜…','â˜¼','â˜¯','â™«','âœˆ','â˜¢','âœ¦','â˜¾','âœ¿','âœª','âš¡','âœ¿'];
  memValues = shuffleArray(icons).slice(0,8);
  memValues = shuffleArray(memValues.concat(memValues));
  memOpen=[]; memMatched=[];
  renderMemory();
}
function renderMemory(){
  $('#memGrid').innerHTML = memValues.map((v,i)=> `<div class="panel center" style="min-height:56px;cursor:pointer" data-i="${i}">${ memMatched.includes(i) ? v : (memOpen.includes(i) ? v : '') }</div>`).join('');
  $$('#memGrid [data-i]').forEach(d=>{
    d.addEventListener('click', ()=>{
      const idx = Number(d.dataset.i);
      if(memMatched.includes(idx) || memOpen.includes(idx)) return;
      memOpen.push(idx); renderMemory();
      if(memOpen.length===2){
        const [a,b] = memOpen;
        if(memValues[a] === memValues[b]){ memMatched.push(a,b); memOpen = []; $('#memMatches').textContent = memMatched.length/2; if(memMatched.length === memValues.length){ addGameScore('Memory', memMatched.length/2); } }
        else { setTimeout(()=>{ memOpen=[]; renderMemory(); }, 700); }
      }
    });
  });
}
$('#memReset').addEventListener('click', ()=> { setupMemory(); $('#memMatches').textContent = 0; });
setupMemory();

// RPS
$$('.rps').forEach(b=> b.addEventListener('click', (e)=>{
  const choice = e.target.dataset.move;
  const moves = ['rock','paper','scissors'];
  const comp = moves[rand(3)];
  let res='Draw';
  if(choice===comp) res='Draw';
  else if((choice==='rock'&&comp==='scissors')||(choice==='paper'&&comp==='rock')||(choice==='scissors'&&comp==='paper')) res='You win';
  else res='You lose';
  $('#rpsRes').textContent = `${res} (you: ${choice}, comp: ${comp})`;
  if(res==='You win') addGameScore('RPS',1);
}));

// Code breaker
let cbCode = String(100 + Math.floor(Math.random()*900));
$('#cbNew').addEventListener('click', ()=> { cbCode = String(100 + Math.floor(Math.random()*900)); $('#cbMsg').textContent = 'New code generated'; });
$('#cbGuess').addEventListener('click', ()=> {
  const guess = ($('#cbInput').value||'').trim();
  if(!/^\d{3}$/.test(guess)){ $('#cbMsg').textContent = 'Enter 3 digits'; return; }
  if(guess === cbCode){ $('#cbMsg').textContent = 'Correct!'; addGameScore('CodeBreaker',1); return; }
  let hint = '';
  for(let i=0;i<3;i++){
    if(guess[i] === cbCode[i]) hint += `${guess[i]}=âœ“ `;
    else if(guess[i] < cbCode[i]) hint += `${guess[i]}< `;
    else hint += `${guess[i]}> `;
  }
  $('#cbMsg').textContent = 'Hint: ' + hint;
});

/* Game scoring & leaderboard (local) */
function addGameScore(kind, score){
  const name = (profile.cur && users[profile.cur]) ? users[profile.cur].display : ('Guest-'+Math.floor(Math.random()*999));
  gamesLeaderboard.push({name,kind,score,date:new Date().toISOString()});
  gamesLeaderboard.sort((a,b)=>b.score-a.score);
  if(gamesLeaderboard.length>100) gamesLeaderboard.length = 100;
  saveAll();
}

/* ========== TOOLS ========= */
const pre = ["Neo","Shadow","Cloud","Byte","Echo","Ghost","Nova","Zero","Drift","Flux"];
const core = ["Root","Kernel","Cipher","Packet","Trace","Shell","Vector","Signal","Loop","Frame"];
const suf = ["404","X","One","Sec","Ops","1337","Net","Lab"];
$('#genName').addEventListener('click', ()=> $('#nameOut').value = pre[rand(pre.length)] + core[rand(core.length)] + suf[rand(suf.length)]);
$('#copyName').addEventListener('click', ()=> { const t = $('#nameOut').value; if(!t) return alert('No alias'); navigator.clipboard?.writeText(t).then(()=> alert('Alias copied')); });
$('#newTip').addEventListener('click', ()=> { $('#tipOut').textContent = FUNFACTS[rand(FUNFACTS.length)]; });

// Password tester live
$('#pwTest').addEventListener('input', ()=>{
  const s = $('#pwTest').value; const sc = passwordScore(s); const w = Math.max(4, Math.min(100, sc));
  $('#pwTestBar').style.width = w + '%';
  $('#pwLabel').textContent = sc < 35 ? 'Weak' : sc < 65 ? 'Medium' : 'Strong';
  $('#pwAdvice').textContent = sc < 35 ? 'Too weak â€” use 10+ chars, mix cases, numbers & symbols' : sc < 65 ? 'Okay â€” add length' : 'Strong â€” use MFA also';
});

/* ========== PROFILE ========== */
$('#profileBtn').addEventListener('click', ()=> {
  if(!profile.cur){ openAuth(); return; }
  showSection('profilePanel');
  $('#profileDisplay').value = users[profile.cur].display;
});
$('#saveProfile').addEventListener('click', ()=>{
  const cur = profile.cur;
  if(!cur) return alert('Sign in first');
  const newName = ($('#profileDisplay').value||'').trim();
  const newPass = ($('#profilePass').value||'').trim();
  if(newName) users[cur].display = newName;
  if(newPass) users[cur].password = newPass;
  saveAll();
  updateProfileUI();
  alert('Profile updated locally');
});
$('#signOut').addEventListener('click', ()=> { profile.cur = null; saveAll(); updateProfileUI(); alert('Signed out'); });

/* ========== INITIAL UI & bindings ========== */
$('#openAuthBtn').addEventListener('click', openAuth);
$('#authClose').addEventListener('click', closeAuth);
$('#btnGotoSignUp').addEventListener('click', ()=> { showSignUp(); });
$('#btnGotoSignIn').addEventListener('click', ()=> { showSignIn(); });
$('#btnForgot').addEventListener('click', ()=> { /* handled above */ });
$('#btnSkip').addEventListener('click', ()=> closeAuth());

$('#dashboardBtn').addEventListener('click', ()=> showSection('dashboard'));
$('#navLessons').addEventListener('click', ()=> showSection('lessons'));
$('#navQuizzes').addEventListener('click', ()=> showSection('quizzes'));
$('#navGames').addEventListener('click', ()=> showSection('games'));
$('#navTools').addEventListener('click', ()=> showSection('toolsPanel'));
$('#navAbout').addEventListener('click', ()=> showSection('about'));

$('#startQuizBtn').addEventListener('click', ()=> startQuiz());

updateProfileUI();
updateProgress();

// Start on dashboard
showSection('dashboard');

window.addEventListener('beforeunload', saveAll);

</script>
</body>
</html>
